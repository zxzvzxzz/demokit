(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{152:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return l})),r.d(t,"metadata",(function(){return s})),r.d(t,"rightToc",(function(){return c})),r.d(t,"default",(function(){return u}));var a=r(2),n=r(10),o=(r(0),r(166)),i=r(167),l={id:"azure-file-sync-and-share",title:"Azure File with File Sync and On-premises AD DS Authentication"},s={id:"azure-storage/azure-file-sync-and-share",isDocsHomePage:!1,title:"Azure File with File Sync and On-premises AD DS Authentication",description:"Demo Request",source:"@site/docs/azure-storage/azure-file-sync-and-share.mdx",permalink:"/demokit/docs/azure-storage/azure-file-sync-and-share",editUrl:"https://github.com/azure/demokit/edit/master/docs/azure-storage/azure-file-sync-and-share.mdx",sidebar:"sidebar",previous:{title:"Azure Storage Demos",permalink:"/demokit/docs/azure-storage/index"}},c=[{value:"Demo Request",id:"demo-request",children:[]},{value:"Demo Environment",id:"demo-environment",children:[]},{value:"Azure File On-premises AD DS Authentication",id:"azure-file-on-premises-ad-ds-authentication",children:[]},{value:"Azure File Share Private Endpoint",id:"azure-file-share-private-endpoint",children:[]},{value:"Azure File Sync",id:"azure-file-sync",children:[]}],p={rightToc:c};function u(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(o.b)("wrapper",Object(a.a)({},p,r,{components:t,mdxType:"MDXLayout"}),Object(o.b)("h2",{id:"demo-request"},"Demo Request"),Object(o.b)("p",null,Object(o.b)("strong",{parentName:"p"},"Fill out this ",Object(o.b)("a",Object(a.a)({parentName:"strong"},{href:"https://forms.office.com/Pages/ResponsePage.aspx?id=v4j5cvGGr0GRqy180BHbR2TLimZclS5AtMUGZWZi-PZUMTcxWElaU0xSSzkxNDk2SkhQQVNVMDlLTC4u",target:"_blank",rel:"nofollow noopener noreferrer"}),"survey")," in order to use the demo.")," Waiting for a completion e-mail sent from ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"mailto:ythuang@microsoft.com"}),"ythuang@microsoft.com"),", demo access credential will be provided in that e-mail, you are good to go with below demo scenarios now."),Object(o.b)("h2",{id:"demo-environment"},"Demo Environment"),Object(o.b)("p",null,"Use the credential provided in e-mail to logon ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com",target:"_blank",rel:"nofollow noopener noreferrer"}),"Azure portal"),', click "Resource Groups" from left panel, 3 resources groups will be listed in below'),Object(o.b)("img",{alt:"azure-file-1",src:Object(i.a)("img/azure-storage/azure-file-1.png")}),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},'"FILESYNC", has "Azure File Sync" resources'),Object(o.b)("li",{parentName:"ul"},'"HOWDY", has all on-premises resources for a faked company called "Howdy", including 2 VMs DC and workstation. DC is also a file server which has a shared folder called "Share" located in F:\\Share.'),Object(o.b)("li",{parentName:"ul"},'"HOWDYONAZURE", has Azure resources including Azure stroage account, file share and privatelink of file share')),Object(o.b)("p",null,"Click each resource group and show it to your customer how it looks like"),Object(o.b)("h2",{id:"azure-file-on-premises-ad-ds-authentication"},"Azure File On-premises AD DS Authentication"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Azure Files\u202fsupports identity-based authentication over Server Message Block (SMB), for more information about AD DS authentication over SMB, refer to this ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/storage/files/storage-files-identity-auth-active-directory-enable",target:"_blank",rel:"nofollow noopener noreferrer"}),"article"),". This demo scenario will include on-premises Active Directory Domain Services (AD DS) authentication.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Click this ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com/#@howdy.site/resource/subscriptions/4ee28f16-3d14-4ee0-8d50-f4b8afc5723c/resourceGroups/HOWDYONAZURE/providers/Microsoft.Storage/storageAccounts/howdyfiles/configuration",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL"),", will bring you to storage account howdyfiles' configuration page, the storage account has already enabled AD DS authentication. "),Object(o.b)("img",{alt:"azure-file-6",src:Object(i.a)("img/azure-storage/azure-file-6.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"The storage account has a file share called ",Object(o.b)("inlineCode",{parentName:"p"},"share")," created already, normally to access this share ",Object(o.b)("inlineCode",{parentName:"p"},"\\\\howdyfiles.file.core.windows.net\\share"),', we need to use storage account "Access key", but with AD DS authentication enabled, you can use your domain user account to access it.'),Object(o.b)("img",{alt:"azure-file-7",src:Object(i.a)("img/azure-storage/azure-file-7.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Run ",Object(o.b)("inlineCode",{parentName:"p"},"mstsc /v:workstation.corp.howdy.site")," from a Windows workstation, use credential provided in e-mail to logon, now you will be logged on as a domain user.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'From logged on terminal session, run "',"\\",'howdyfiles.file.core.windows.net\\share", a shared folder will open.'),Object(o.b)("img",{alt:"azure-file-8",src:Object(i.a)("img/azure-storage/azure-file-8.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Try create, modify and delete any files or folders, the experience is similar just like using an on-premises file server."))),Object(o.b)("h2",{id:"azure-file-share-private-endpoint"},"Azure File Share Private Endpoint"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Azure Private Endpoint is a network interface that connects you privately and securely to a service powered by Azure Private Link. Private Endpoint uses a private IP address from your VNet, effectively bringing the service into your VNet. The service will be only available and accessible from your private network address space, if ExpressRouter/VPN connection is established between your on-premises network and Azure virtual network, you can access private endpoint from on-premises as well. In this demo, we will use Azure file share private endpoint as an example to show how it works.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Logon to on-premises workstation. Skip this step if you already logged on workstation. Run ",Object(o.b)("inlineCode",{parentName:"p"},"mstsc /v:workstation.corp.howdy.site")," from a Windows workstation, use credential provided in e-mail to logon.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"From the terminal session, open a command prompt window, run ",Object(o.b)("inlineCode",{parentName:"p"},"nslookup -opt d2 howdyfiles.file.core.windows.net"),", the result will look like in below"))),Object(o.b)("pre",null,Object(o.b)("code",Object(a.a)({parentName:"pre"},{className:"language-sh",metastring:"{11-13,15-17}","{11-13,15-17}":!0}),"...\nGot answer (103 bytes):\n    HEADER:\n        opcode = QUERY, id = 6, rcode = NOERROR\n        header flags:  response, want recursion, recursion avail.\n        questions = 1,  answers = 2,  authority records = 0,  additional = 0\n\n    QUESTIONS:\n        howdyfiles.file.core.windows.net, type = A, class = IN\n    ANSWERS:\n    ->  howdyfiles.file.core.windows.net\n        type = CNAME, class = IN, dlen = 25\n        canonical name = howdyfiles.privatelink.file.core.windows.net\n        ttl = 53 (53 secs)\n    ->  howdyfiles.privatelink.file.core.windows.net\n        type = A, class = IN, dlen = 4\n        internet address = 10.1.1.4\n        ttl = 3600 (1 hour)\n...\n")),Object(o.b)("ol",{start:4},Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"You will see ",Object(o.b)("inlineCode",{parentName:"p"},"howdyfiles.file.core.windows.net")," is actually a CNAME to ",Object(o.b)("inlineCode",{parentName:"p"},"howdyfiles.privatelink.file.core.windows.net"),", and ",Object(o.b)("inlineCode",{parentName:"p"},"howdyfiles.privatelink.file.core.windows.net")," is resolved to a private IP address ",Object(o.b)("inlineCode",{parentName:"p"},"10.1.1.4"),", this is because we have enabled private endpoint for Azure file share. Open this ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com/#@howdy.site/resource/subscriptions/4ee28f16-3d14-4ee0-8d50-f4b8afc5723c/resourceGroups/HOWDYONAZURE/providers/Microsoft.Network/privateEndpoints/howdyfilespe/overview",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL"),", the page will list how private endpoint is configured"),Object(o.b)("img",{alt:"azure-file-9",src:Object(i.a)("img/azure-storage/azure-file-9.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"When private endpoint is enabled, Azure storage firewall will deny access to traffic from all networks (including internet traffic) on the public endpoint. Open this ",Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com/#@howdy.site/resource/subscriptions/4ee28f16-3d14-4ee0-8d50-f4b8afc5723c/resourceGroups/HOWDYONAZURE/providers/Microsoft.Storage/storageAccounts/howdyfiles/accessControl",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL")," to show how storage firewall settings look like"),Object(o.b)("img",{alt:"azure-file-10",src:Object(i.a)("img/azure-storage/azure-file-10.png")}))),Object(o.b)("h2",{id:"azure-file-sync"},"Azure File Sync"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'"Azure File Sync" is used to centralize your organization\'s file shares in Azure Files. For more informaiton about "Azure File Sync", refer to this ',Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/storage/files/storage-sync-files-deployment-guide?tabs=azure-portal",target:"_blank",rel:"nofollow noopener noreferrer"}),"article"),'.We have pre-installed "Azure Storage Sync Agent" on on-premises file server (DC) and configured "Sync group" from "Storage Sync Service". To show how it looks like, click this ',Object(o.b)("a",Object(a.a)({parentName:"p"},{href:"https://portal.azure.com/#@howdy.site/resource/subscriptions/4ee28f16-3d14-4ee0-8d50-f4b8afc5723c/resourceGroups/FILESYNC/providers/Microsoft.StorageSync/storageSyncServices/filesync/overview",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL")),Object(o.b)("img",{alt:"azure-file-2",src:Object(i.a)("img/azure-storage/azure-file-2.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'Click "Howdy" under "Sync groups" will bring you to detailed configration page, currently it has "1 cloud endpoints" and "1 server endpoints" configured'),Object(o.b)("img",{alt:"azure-file-3",src:Object(i.a)("img/azure-storage/azure-file-3.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},'Click each endpoint in above page will show how "Cloud Endpoint" and "Server Endpoint" configuration look like.'),Object(o.b)("img",{alt:"azure-file-4",src:Object(i.a)("img/azure-storage/azure-file-4.png")}),Object(o.b)("img",{alt:"azure-file-5",src:Object(i.a)("img/azure-storage/azure-file-5.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Logon to on-premises workstation. Skip this step if you already logged on workstation. Run ",Object(o.b)("inlineCode",{parentName:"p"},"mstsc /v:workstation.corp.howdy.site")," from a Windows workstation, use credential provided in e-mail to logon.")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Visit ",Object(o.b)("inlineCode",{parentName:"p"},"\\\\dc\\share"),' from windows explore, this will open shared folder from our local file server. Try to create a test file say test.txt and add one line "This is a test file" to it. Now open another explore window and visit ',Object(o.b)("inlineCode",{parentName:"p"},"\\\\howdyfiles.file.core.windows.net\\share"),', it will has test.txt as well(It may take some time, if you didn\'t see this file, press F5 to refresh for a few of times). This is because "Azure storage sync agent" help us sync the file to azure storage files.'),Object(o.b)("img",{alt:"azure-file-11",src:Object(i.a)("img/azure-storage/azure-file-11.png")})),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"Azure file sync will also handle conflict, it will generate a conflict file, if the file was changed in multiple places at the same time (or more accurately, if one change was before having received the other change). For example:"),Object(o.b)("ul",{parentName:"li"},Object(o.b)("li",{parentName:"ul"},"File test.txt is modified in location X, and given LastWriteTime of 1:00"),Object(o.b)("li",{parentName:"ul"},"File test.txt is modified in location Y, and given LastWriteTime of 1:05"),Object(o.b)("li",{parentName:"ul"},"When conflict resolution happens, the file content from 1:05 will be get to keep the filename test.txt"),Object(o.b)("li",{parentName:"ul"},"The file content from 1:00 will become a 'conflict file', and given the name ",Object(o.b)("inlineCode",{parentName:"li"},"test-<MachineName>.txt")),Object(o.b)("li",{parentName:"ul"},"The ",Object(o.b)("inlineCode",{parentName:"li"},"<MachineName>")," is the name of the server which produced the change from 1:00"),Object(o.b)("li",{parentName:"ul"},"If the change came from a direct write to the cloud share, it will be given the name ",Object(o.b)("inlineCode",{parentName:"li"},"<MachineName>"),' will be "Cloud"'))),Object(o.b)("li",{parentName:"ol"},Object(o.b)("p",{parentName:"li"},"To explain how azure file sync handles conflict, open test.txt from ",Object(o.b)("inlineCode",{parentName:"p"},"\\\\howdyfiles.file.core.windows.net")," and ",Object(o.b)("inlineCode",{parentName:"p"},"\\\\dc\\share"),' seperately, append a line "local" to test.txt opened from ',Object(o.b)("inlineCode",{parentName:"p"},"\\\\howdyfiles.file.core.windows.net"),', then press Ctrl+S to save the change, append a line "cloud" to test.txt opened from ',Object(o.b)("inlineCode",{parentName:"p"},"\\\\dc\\share"),", then press Ctrl+S to save the change. Wait for couple of minutes (might be > 10 minutes), eventually, you will see two files test.txt and test-Cloud.txt both from Azure file share and local file share, as we saved test.txt from Azure file share first, so that file will be renamed to test-Cloud.txt"),Object(o.b)("img",{alt:"azure-file-12",src:Object(i.a)("img/azure-storage/azure-file-12.png")}))))}u.isMDXComponent=!0},165:function(e,t,r){"use strict";var a=r(0),n=r(52);t.a=function(){return Object(a.useContext)(n.a)}},166:function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return f}));var a=r(0),n=r.n(a);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var c=n.a.createContext({}),p=function(e){var t=n.a.useContext(c),r=t;return e&&(r="function"==typeof e?e(t):l(l({},t),e)),r},u=function(e){var t=p(e.components);return n.a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},b=n.a.forwardRef((function(e,t){var r=e.components,a=e.mdxType,o=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(r),b=a,f=u["".concat(i,".").concat(b)]||u[b]||d[b]||o;return r?n.a.createElement(f,l(l({ref:t},c),{},{components:r})):n.a.createElement(f,l({ref:t},c))}));function f(e,t){var r=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=r.length,i=new Array(o);i[0]=b;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<o;c++)i[c]=r[c];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,r)}b.displayName="MDXCreateElement"},167:function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));r(76);var a=r(165),n=r(168);function o(e,t){var r=void 0===t?{}:t,o=r.forcePrependBaseUrl,i=void 0!==o&&o,l=r.absolute,s=void 0!==l&&l,c=Object(a.a)().siteConfig,p=(c=void 0===c?{}:c).baseUrl,u=void 0===p?"/":p,d=c.url;if(!e)return e;if(i)return u+e;if(!Object(n.a)(e))return e;var b=u+e.replace(/^\//,"");return s?d+b:b}},168:function(e,t,r){"use strict";function a(e){return!1===/^(https?:|\/\/|mailto:|tel:)/.test(e)}r.d(t,"a",(function(){return a}))}}]);