(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{155:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return c})),r.d(t,"metadata",(function(){return l})),r.d(t,"rightToc",(function(){return s})),r.d(t,"default",(function(){return b}));var o=r(2),n=r(10),a=(r(0),r(163)),i=r(162),c={id:"arc-for-kubernetes",title:"Arc for Kubernetes"},l={id:"kubernetes-devops/arc-for-kubernetes",isDocsHomePage:!1,title:"Arc for Kubernetes",description:"Arc for Kubernetes Demo Scenarios",source:"@site/docs/kubernetes-devops/arc-for-kubernetes.mdx",permalink:"/demokit/docs/kubernetes-devops/arc-for-kubernetes",editUrl:"https://github.com/azure/demokit/edit/master/docs/kubernetes-devops/arc-for-kubernetes.mdx",sidebar:"sidebar",previous:{title:"Kubernetes DevOps Introduction",permalink:"/demokit/docs/kubernetes-devops/index"},next:{title:"Github Actions",permalink:"/demokit/docs/kubernetes-devops/github"}},s=[{value:"Arc for Kubernetes Demo Scenarios",id:"arc-for-kubernetes-demo-scenarios",children:[]},{value:"GitOps Demo",id:"gitops-demo",children:[]},{value:"Arc Enabled Cluster Monitoring Demo",id:"arc-enabled-cluster-monitoring-demo",children:[]},{value:"Arc Enabled Cluster Policy Demo",id:"arc-enabled-cluster-policy-demo",children:[]}],p={rightToc:s};function b(e){var t=e.components,r=Object(n.a)(e,["components"]);return Object(a.b)("wrapper",Object(o.a)({},p,r,{components:t,mdxType:"MDXLayout"}),Object(a.b)("h2",{id:"arc-for-kubernetes-demo-scenarios"},"Arc for Kubernetes Demo Scenarios"),Object(a.b)("p",null,"Arc for Kubernetes contains below demos"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"GitOps demo, by leveraging github and Arc for Kubernetes shows how to deploy your packages to AKS cluster."),Object(a.b)("li",{parentName:"ul"},"Kubernetes cluster monitoring demo, shows how to monitor Kubernetes cluster from on-premises or from other cloud provider."),Object(a.b)("li",{parentName:"ul"},"Azure Kubernetes policy demo, shows how to apply policy controls on Arc managed Kubernetes cluster.")),Object(a.b)("h2",{id:"gitops-demo"},"GitOps Demo"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Click this ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL"),', it is an "Arc for Kubernetes" environment shows in Azure portal, you can click each blade and shows how it looks like.'),Object(a.b)("img",{alt:"arc-1",src:Object(i.a)("img/kubernetes-devops/arc-1.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Open URL ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"http://vote-arc.k8s.devsecops.ink",target:"_blank",rel:"nofollow noopener noreferrer"}),"http://vote-arc.k8s.devsecops.ink"),", this is an application deployed into Arc managed Kubernetes cluster, we will demo how to apply GitOps on this application, currently the application has version v1, highlight the version to your customer at this moment."),Object(a.b)("img",{alt:"arc-2",src:Object(i.a)("img/kubernetes-devops/arc-2.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Open URL ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/devopsonazure/vote-arc/blob/master/manifests/deployment.yml",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://github.com/devopsonazure/vote-arc/blob/master/manifests/deployment.yml"),", this file is deployment file hosted in github, you should be able to edit this file with your own GitHub account. Explain to your customer it is already deployed to Arc managed Kubernetes cluster, you are going to simulate the a deployment by modifying the deployment file, click highlighted edit button(pen icon), change highlighted line from ",Object(a.b)("inlineCode",{parentName:"p"},"huangyingting/azre-vote-front-arc:v1")," to ",Object(a.b)("inlineCode",{parentName:"p"},"huangyingting/azure-vote-front-arc:v2"),", or ",Object(a.b)("inlineCode",{parentName:"p"},"v3"),", ",Object(a.b)("inlineCode",{parentName:"p"},"v4"),", ",Object(a.b)("inlineCode",{parentName:"p"},"v5"),"."))),Object(a.b)("pre",null,Object(a.b)("code",Object(o.a)({parentName:"pre"},{className:"language-yaml",metastring:"{3}","{3}":!0}),"...\n      - name: azure-vote-front\n        image: huangyingting/azure-vote-front-arc:v1\n        ports:\n        - containerPort: 80\n        resources:\n          requests:\n            cpu: 250m\n          limits:\n            cpu: 500m\n...            \n")),Object(a.b)("ol",{start:4},Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Click ",Object(a.b)("inlineCode",{parentName:"p"},"Commit changes")," button to commit the change."),Object(a.b)("img",{alt:"arc-4",src:Object(i.a)("img/kubernetes-devops/arc-4.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},'It should take 1 \u2013 2 minutes to apply the new change on Arc managed kubernetes cluster, right now, you could go to webpage opened in step 1, then go to Configurations->Add configuration, explain to your customer how to deploy an application from "Arc for Kubernetes", a sample configuration is provided in below screen shot, basically it is related with writing kubernete yaml files or creating helm deployment files, in this demo, we simply use kubernetes yaml files, all those yaml files are located in ',Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/devopsonazure/vote-arc/tree/master/manifests",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://github.com/devopsonazure/vote-arc/tree/master/manifests"),", you can open those yaml files and explain to your customer how they look like."),Object(a.b)("img",{alt:"arc-5",src:Object(i.a)("img/kubernetes-devops/arc-5.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Open URL ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"http://vote-arc.k8s.devsecops.ink",target:"_blank",rel:"nofollow noopener noreferrer"}),"http://vote-arc.k8s.devsecops.ink"),", refresh it, it should change to corresponding version set in step 3."),Object(a.b)("img",{alt:"arc-6",src:Object(i.a)("img/kubernetes-devops/arc-6.png")}))),Object(a.b)("h2",{id:"arc-enabled-cluster-monitoring-demo"},"Arc Enabled Cluster Monitoring Demo"),Object(a.b)("p",null,"Click this ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL"),', from opened Azure portal, go to Monitoring->Insights(preview), now you can demo how "Arc for Kubernetes" monitoring works, click Cluster, Health (Preview), Nodes, Controller and Containers, explain how monitoring looks like in arc managed kubernetes cluster.\nFor more information of container monitoring, refer to ',Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/azure-arc/kubernetes/deploy-azure-monitor-for-containers",target:"_blank",rel:"nofollow noopener noreferrer"}),"Enable monitoring of Azure Arc enabled Kubernetes cluster")),Object(a.b)("img",{alt:"arc-7",src:Object(i.a)("img/kubernetes-devops/arc-7.png")}),Object(a.b)("h2",{id:"arc-enabled-cluster-policy-demo"},"Arc Enabled Cluster Policy Demo"),Object(a.b)("ol",null,Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"Arc for Kubernetes leverages ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/open-policy-agent/gatekeeper",target:"_blank",rel:"nofollow noopener noreferrer"}),"gatekeeper")," to meet governance and legal requirements, the policy definition is integrated into Azure policy. To demo how to use kubernetes policy, click this ",Object(a.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview",target:"_blank",rel:"nofollow noopener noreferrer"}),"URL"),", then go to Policies, "),Object(a.b)("img",{alt:"arc-8",src:Object(i.a)("img/kubernetes-devops/arc-8.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},'Click "',"[Preview]",': Ensure services listen only on allowed ports in Kubernetes cluster" policy, then "Edit assignment", from opened page, go to "Parameters", explain to customer current policy assignment only allows port 6379, 80, 11211 and 443, if a deployment tries to create other ports like port 8080, then it will get denied.'),Object(a.b)("img",{alt:"arc-9",src:Object(i.a)("img/kubernetes-devops/arc-9.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},'Close "Assignment Details", then go to "View definition", policy definition in ARM template will be listed, go to constraintTemplate, open the URL, reveal how real gatekeeper policy looks like, it is an OPA constraint template.'),Object(a.b)("img",{alt:"arc-10",src:Object(i.a)("img/kubernetes-devops/arc-10.png")})),Object(a.b)("li",{parentName:"ol"},Object(a.b)("p",{parentName:"li"},"To show how constraint template works, "))),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"Open ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml"),", explain we are going to deploy a service and bind it to port 8080. "),Object(a.b)("li",{parentName:"ul"},"Visit ",Object(a.b)("a",Object(o.a)({parentName:"li"},{href:"https://shell.azure.com",target:"_blank",rel:"nofollow noopener noreferrer"}),"https://shell.azure.com"),", choose Bash"),Object(a.b)("li",{parentName:"ul"},"From cloud shell, run ",Object(a.b)("inlineCode",{parentName:"li"},"git clone https://github.com/devopsonazure/devopsonazure")),Object(a.b)("li",{parentName:"ul"},"Type ",Object(a.b)("inlineCode",{parentName:"li"},"cd devopsonazure")),Object(a.b)("li",{parentName:"ul"},"Run ",Object(a.b)("inlineCode",{parentName:"li"},"kubectl --kubeconfig arcpolicy apply -f https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml -n policy"),". This command basically tries to deploy a service at 8080, because our policy doesn\u2019t allow port 8080, so it will be ended with below error",Object(a.b)("img",{alt:"arc-11",src:Object(i.a)("img/kubernetes-devops/arc-11.png")}))))}b.isMDXComponent=!0},161:function(e,t,r){"use strict";var o=r(0),n=r(52);t.a=function(){return Object(o.useContext)(n.a)}},162:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));r(76);var o=r(161),n=r(164);function a(e,t){var r=void 0===t?{}:t,a=r.forcePrependBaseUrl,i=void 0!==a&&a,c=r.absolute,l=void 0!==c&&c,s=Object(o.a)().siteConfig,p=(s=void 0===s?{}:s).baseUrl,b=void 0===p?"/":p,u=s.url;if(!e)return e;if(i)return b+e;if(!Object(n.a)(e))return e;var m=b+e.replace(/^\//,"");return l?u+m:m}},163:function(e,t,r){"use strict";r.d(t,"a",(function(){return b})),r.d(t,"b",(function(){return d}));var o=r(0),n=r.n(o);function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){a(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function l(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var s=n.a.createContext({}),p=function(e){var t=n.a.useContext(s),r=t;return e&&(r="function"==typeof e?e(t):c(c({},t),e)),r},b=function(e){var t=p(e.components);return n.a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.a.createElement(n.a.Fragment,{},t)}},m=n.a.forwardRef((function(e,t){var r=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),b=p(r),m=o,d=b["".concat(i,".").concat(m)]||b[m]||u[m]||a;return r?n.a.createElement(d,c(c({ref:t},s),{},{components:r})):n.a.createElement(d,c({ref:t},s))}));function d(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=r.length,i=new Array(a);i[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:o,i[1]=c;for(var s=2;s<a;s++)i[s]=r[s];return n.a.createElement.apply(null,i)}return n.a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},164:function(e,t,r){"use strict";function o(e){return!1===/^(https?:|\/\/|mailto:|tel:)/.test(e)}r.d(t,"a",(function(){return o}))}}]);