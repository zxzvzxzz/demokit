(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{112:function(e,t,r){"use strict";r.r(t),r.d(t,"frontMatter",(function(){return i})),r.d(t,"metadata",(function(){return c})),r.d(t,"rightToc",(function(){return s})),r.d(t,"default",(function(){return b}));var o=r(2),a=r(7),n=(r(0),r(125)),i={id:"arc-for-kubernetes",title:"Arc for Kubernetes"},c={id:"kubernetes-devops/arc-for-kubernetes",isDocsHomePage:!1,title:"Arc for Kubernetes",description:"Arc for Kubernetes Demo Scenarios",source:"@site/docs\\kubernetes-devops\\arc-for-kubernetes.md",permalink:"/demokit/docs/kubernetes-devops/arc-for-kubernetes",editUrl:"https://github.com/azure/demokit/edit/master/docs/kubernetes-devops/arc-for-kubernetes.md",sidebar:"sidebar",previous:{title:"Kubernetes DevOps Introduction",permalink:"/demokit/docs/kubernetes-devops/index"},next:{title:"Github Actions",permalink:"/demokit/docs/kubernetes-devops/github"}},s=[{value:"Arc for Kubernetes Demo Scenarios",id:"arc-for-kubernetes-demo-scenarios",children:[]},{value:"GitOps Demo",id:"gitops-demo",children:[]},{value:"Arc Enabled Cluster Monitoring Demo",id:"arc-enabled-cluster-monitoring-demo",children:[]},{value:"Arc Enabled Cluster Policy Demo",id:"arc-enabled-cluster-policy-demo",children:[]}],l={rightToc:s};function b(e){var t=e.components,r=Object(a.a)(e,["components"]);return Object(n.b)("wrapper",Object(o.a)({},l,r,{components:t,mdxType:"MDXLayout"}),Object(n.b)("h2",{id:"arc-for-kubernetes-demo-scenarios"},"Arc for Kubernetes Demo Scenarios"),Object(n.b)("p",null,"Arc for Kubernetes contains below demos"),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"GitOps demo, by leveraging github and Arc for Kubernetes shows how to deploy your packages to AKS cluster."),Object(n.b)("li",{parentName:"ul"},"Kubernetes cluster monitoring demo, shows how to monitor Kubernetes cluster from on-premises or from other cloud provider."),Object(n.b)("li",{parentName:"ul"},"Azure Kubernetes policy demo, shows how to apply policy controls on Arc managed Kubernetes cluster.")),Object(n.b)("h2",{id:"gitops-demo"},"GitOps Demo"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Click this ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview"}),"URL"),', it is an "Arc for Kubernetes" environment shows in Azure portal, you can click each blade and shows how it looks like.\n',Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-1.png",alt:"arc-1"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"From browser, open URL ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"http://vote-arc.k8s.devsecops.ink"}),"http://vote-arc.k8s.devsecops.ink"),", this is an application deployed into Arc managed Kubernetes cluster, we will demo how to apply GitOps on this application, currently the application has version v1, highlight the version to your customer at this moment.\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-2.png",alt:"arc-2"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"From browser, open ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/devopsonazure/vote-arc/blob/master/manifests/deployment.yml"}),"https://github.com/devopsonazure/vote-arc/blob/master/manifests/deployment.yml")," this is the source project hosted in github, you should be able to edit this file with your own GitHub account. Explain to your customer it is already deployed to Arc managed Kubernetes cluster, you are going to simulate the a deployment by modifying the deployment source, step 1 is clicking the highlighted button, step 2 modifying image from huangyingting/azre-vote-front-arc:v1 to huangyingting/azure-vote-front-arc:v2, or v3, v4, v5.\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-3.png",alt:"arc-3"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},'Click "Commit changes" button to commit the change.\n',Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-4.png",alt:"arc-4"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},'It should take 1 \u2013 2 minutes to apply the new change, right now, you could go to webpage opened in step 1, then go to Configurations->Add configuration, explain to your customer how to deploy an application from "Arc for Kubernetes", a sample configuration is provided in below screen shot, basically it is related with writing kubernete yaml files or creating helm deployment files, in this demo, we simply use a Kubernetes yaml files, all those yaml files are in ',Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/devopsonazure/vote-arc/tree/master/manifests"}),"https://github.com/devopsonazure/vote-arc/tree/master/manifests"),", so just explain to your customer how it looks like.\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-5.png",alt:"arc-5"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Open URL ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"http://vote-arc.k8s.devsecops.ink"}),"http://vote-arc.k8s.devsecops.ink"),", refresh it, now it should change to corresponding version.\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-6.png",alt:"arc-6"}))))),Object(n.b)("h2",{id:"arc-enabled-cluster-monitoring-demo"},"Arc Enabled Cluster Monitoring Demo"),Object(n.b)("p",null,"Click this ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview"}),"URL"),", from opened Azure portal, go to Monitoring->Insights(preview), now you can demo how Arc for Kubernetes monitoring works, click Cluster, Health (Preview), Nodes, Controller and Containers, explain how monitoring looks like in Arc for Kubernetes.\nThe detailed reference document can be found at ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://docs.microsoft.com/en-us/azure/azure-arc/kubernetes/deploy-azure-monitor-for-containers"}),"Enable monitoring of Azure Arc enabled Kubernetes cluster"),"\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-7.png",alt:"arc-7"}))),Object(n.b)("h2",{id:"arc-enabled-cluster-policy-demo"},"Arc Enabled Cluster Policy Demo"),Object(n.b)("ol",null,Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"Arc for Kubernetes leverages ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://github.com/open-policy-agent/gatekeeper"}),"gatekeeper")," to meet governance and legal requirements, the policy definition is integrated into Azure policy itself, to demo how it works, click this ",Object(n.b)("a",Object(o.a)({parentName:"p"},{href:"https://ms.portal.azure.com/?feature.azureArc=true&Microsoft_Azure_ContainerService=flight4&feature.enablearck8smonitoring=true&feature.azureAroV4=true#@microsoft.onmicrosoft.com/resource/subscriptions/513df66c-64b0-4c0b-a13a-7f37bb384aff/resourceGroups/AzureArc/providers/Microsoft.Kubernetes/connectedClusters/K8SARC/overview"}),"URL"),", then go to Policies,\n",Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-8.png",alt:"arc-8"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},'Click "',"[Preview]",': Ensure services listen only on allowed ports in Kubernetes cluster" policy, then "Edit assignment", from opened page, go to "Parameters", explain to customer current policy assignment only allows port 6379, 80, 11211 and 443, if a deployment tries to create other ports like port 8080, then it will get denied.\n',Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-9.png",alt:"arc-9"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},'Close "Assignment Details", then go to "View definition", it will list policy definition in ARM template, go to constraintTemplate, open the URL, it will reveal how the real policy looks like, it is an OPA constraint template.\n',Object(n.b)("img",Object(o.a)({parentName:"p"},{src:"../../img/kubernetes-devops/arc-10.png",alt:"arc-10"})))),Object(n.b)("li",{parentName:"ol"},Object(n.b)("p",{parentName:"li"},"To show how constraint template works, "))),Object(n.b)("ul",null,Object(n.b)("li",{parentName:"ul"},"Visit ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://shell.azure.com"}),"https://shell.azure.com"),", choose Bash"),Object(n.b)("li",{parentName:"ul"},"From cloud shell, run ",Object(n.b)("inlineCode",{parentName:"li"},"git clone https://github.com/devopsonazure/devopsonazure")),Object(n.b)("li",{parentName:"ul"},"Type ",Object(n.b)("inlineCode",{parentName:"li"},"cd devopsonazure")),Object(n.b)("li",{parentName:"ul"},"Run ",Object(n.b)("inlineCode",{parentName:"li"},"kubectl --kubeconfig arcpolicy apply -f https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml -n policy"),", this command basically tries to deploy a service at 8080, because our policy doesn\u2019t allow port 8080, so it will end with below error\n",Object(n.b)("img",Object(o.a)({parentName:"li"},{src:"../../img/kubernetes-devops/arc-11.png",alt:"arc-11"}))),Object(n.b)("li",{parentName:"ul"},"Open ",Object(n.b)("a",Object(o.a)({parentName:"li"},{href:"https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml"}),"https://raw.githubusercontent.com/devopsonazure/vote-arc/master/policy/service-port-not-allowed.yaml")," to explain the service tries to bind to port 8080. ")))}b.isMDXComponent=!0}}]);