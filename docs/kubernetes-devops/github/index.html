<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-172450760-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-172450760-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-172450760-1",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Azure Sales Demo Kit" href="/demokit/opensearch.xml"><title data-react-helmet="true">Github Actions | Azure Sales Demo Kit</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Github Actions | Azure Sales Demo Kit"><meta data-react-helmet="true" name="description" content="Github Actions Demo Scenarios"><meta data-react-helmet="true" property="og:description" content="Github Actions Demo Scenarios"><meta data-react-helmet="true" property="og:url" content="https://azure.github.io//demokit/docs/kubernetes-devops/github"><link data-react-helmet="true" rel="shortcut icon" href="/demokit/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://azure.github.io//demokit/docs/kubernetes-devops/github"><link rel="stylesheet" href="/demokit/styles.3bae52e5.css">
<link rel="preload" href="/demokit/styles.0662f249.js" as="script">
<link rel="preload" href="/demokit/runtime~main.70ec3584.js" as="script">
<link rel="preload" href="/demokit/main.6e8f544f.js" as="script">
<link rel="preload" href="/demokit/common.fda475de.js" as="script">
<link rel="preload" href="/demokit/2.c70536f9.js" as="script">
<link rel="preload" href="/demokit/18.a46e127c.js" as="script">
<link rel="preload" href="/demokit/19.4c1ea291.js" as="script">
<link rel="preload" href="/demokit/8f5690b9.b140be44.js" as="script">
<link rel="preload" href="/demokit/17896441.2b4e130e.js" as="script">
<link rel="preload" href="/demokit/2a5ffa6d.2239ce31.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/demokit/"><img class="navbar__logo" src="/demokit/img/logo.svg" alt="Azure Sales Demo Kit"><strong class="navbar__title">Azure Sales Demo Kit</strong></a></div><div class="navbar__items navbar__items--right"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/demokit/docs/welcome">Demo Kit</a><a href="https://github.com/azure/demokit" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="mailto:demokit@microsoft.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contact Us</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><div class="searchWrapper_-F3-"><span aria-label="expand searchbar" role="button" class="searchIconButton_1Dnz" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input searchInput_2eto"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/demokit/"><img class="navbar__logo" src="/demokit/img/logo.svg" alt="Azure Sales Demo Kit"><strong class="navbar__title">Azure Sales Demo Kit</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/demokit/docs/welcome">Demo Kit</a></li><li class="menu__list-item"><a href="https://github.com/azure/demokit" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="mailto:demokit@microsoft.com" target="_blank" rel="noopener noreferrer" class="menu__link">Contact Us</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp" role="complementary"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/demokit/docs/welcome">Welcome</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Kubernetes DevOps</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/demokit/docs/kubernetes-devops/index">Kubernetes DevOps Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/demokit/docs/kubernetes-devops/arc-for-kubernetes">Arc for Kubernetes</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/demokit/docs/kubernetes-devops/github">Github Actions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/demokit/docs/kubernetes-devops/devops">Azure DevOps</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/demokit/docs/kubernetes-devops/argocd">ArgoCD</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Github Actions</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="github-actions-demo-scenarios"></a>Github Actions Demo Scenarios<a aria-hidden="true" tabindex="-1" class="hash-link" href="#github-actions-demo-scenarios" title="Direct link to heading">#</a></h2><p>Github devops demo leverages github actions to build application, generate docker image, push image to azure container registry, and deploy image to AKS. It includes below actions</p><ul><li>Github actions implemented pipleline</li><li>Canary deployment</li><li>Codeql to scan code triggered by push or schedule</li></ul><p>This demo supports below scenarios</p><ul><li>DevOps pipeline – build &amp; deploy</li><li>Canary deployment on AKS</li><li>Roll back on error to successful deployment</li></ul><p>To use this demo, follow below steps to open 3 webpages</p><ol><li>Open <a href="http://vote-github.k8s.devsecops.ink/" target="_blank" rel="noopener noreferrer">webpage 1</a>, this is sample vote demo application which is deployed to AKS already, currently, its version is <code>Azure Voting App - Github Actions(v1)</code>, highlight application version to your customer, lately the version will get changed to <code>Azure Voting App – Github Actions(v2)</code></li><li>Open <a href="https://github.com/devopsonazure/vote-github/blob/master/azure-vote/config_file.cfg">webpage 2</a>, this is sample application configuration file, we are going to change the configuration, rebuild and deploy it to AKS with github actions.</li><li>Open <a href="https://github.com/devopsonazure/vote-github/actions" target="_blank" rel="noopener noreferrer">webpage 3</a>, this is github actions page, the build &amp; deploy workflows will be shown here.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="demo-steps"></a>Demo Steps<a aria-hidden="true" tabindex="-1" class="hash-link" href="#demo-steps" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="github-actions-pipeline"></a>Github Actions Pipeline<a aria-hidden="true" tabindex="-1" class="hash-link" href="#github-actions-pipeline" title="Direct link to heading">#</a></h3><ol><li>Go to webpage 2, click edit icon and change TITLE from <code>Azure Voting App - Github Actions(v1)</code> to <code> Azure Voting App - Github Actions(v2)</code>.
<img src="../../img/kubernetes-devops/github-1.png" alt="github-1"></li><li>Click <code>Commit changes</code> button to commit the change.
<img src="../../img/kubernetes-devops/github-2.png" alt="github-2"></li><li>Switch to webpage 3, refresh the page (might be multiple times), it will show github actions pipeline is started. It contains two actions, one is code scanning, another is build and deploy.
<img src="../../img/kubernetes-devops/github-3.png" alt="github-3"></li><li>Click <code>Build and deploy</code> action, it has two stages, one is build and another is deploy, explain to your customer what github actions are doing right now, basically, those actions include building code, pushing image to azure container registry, and deploying the imaging to AKS.
<img src="../../img/kubernetes-devops/github-4.png" alt="github-4"></li><li>Once build &amp; deploy is completed, go to webpage 1, refresh it, you will see the version is changed to <code>Azure Voting App – Github Actions(v2)</code><img src="../../img/kubernetes-devops/github-5.png" alt="github-5"></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="canary-deployment-on-aks"></a>Canary Deployment on AKS<a aria-hidden="true" tabindex="-1" class="hash-link" href="#canary-deployment-on-aks" title="Direct link to heading">#</a></h3><ol><li>Visit URL <a href="https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml">https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml</a>, uncomment below lines then commit the change to github.
<img src="../../img/kubernetes-devops/github-6.png" alt="github-6"></li><li>Visit URL <a href="https://github.com/devopsonazure/vote-github/blob/master/azure-vote/config_file.cfg">https://github.com/devopsonazure/vote-github/blob/master/azure-vote/config_file.cfg</a>, modify version to v3, then commit change。
<img src="../../img/kubernetes-devops/github-7.png" alt="github-7"></li><li>Go to webpage 1, refresh page, the version of application should change to v3.
<img src="../../img/kubernetes-devops/github-8.png" alt="github-8"></li><li>Now, open a new browser and use in-private mode, paste and visit same URL from webpage 1, it should display v2.
<img src="../../img/kubernetes-devops/github-9.png" alt="github-9"></li><li>This is because we have enabled canary deployment, both versions exist in same cluster, AKS will handle the requests and distribute them to different version of services.  From AKS backend, it has two deploys<div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-sh codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">kubectl get deploy -n github </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">NAME                        READY   UP-TO-DATE   AVAILABLE   AGE</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">azure-vote-back             1/1     1            1           3d23h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">azure-vote-front            1/1     1            1           3d19h</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">azure-vote-front-baseline   1/1     1            1           22m</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">azure-vote-front-canary     1/1     1            1           22m</span></div></div></div></div></div></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="roll-back-on-error"></a>Roll back on error<a aria-hidden="true" tabindex="-1" class="hash-link" href="#roll-back-on-error" title="Direct link to heading">#</a></h3><ol><li>Visit URL <a href="https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml">https://github.com/devopsonazure/vote-github/edit/master/.github/workflows/build-deploy.yaml</a>, add &quot;_failed&quot; into below line, then commit change to github, it will trigger a failed deployment
<img src="../../img/kubernetes-devops/github-10.png" alt="github-10"></li><li>Go to <a href="https://github.com/devopsonazure/vote-github/actions" target="_blank" rel="noopener noreferrer">https://github.com/devopsonazure/vote-github/actions</a>, click the newest <code>Build and deploy</code> pipeline, wait for a while until the deployment get failed, show below screen to your customer, github actions pipeline will roll back on error to previous successful deployment.
<img src="../../img/kubernetes-devops/github-11.png" alt="github-11"></li><li>Go to webpage 1, refresh, it proves the service is still running and not affected by failed deployment.</li></ol></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/azure/demokit/edit/master/docs/kubernetes-devops/github.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/demokit/docs/kubernetes-devops/arc-for-kubernetes"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Arc for Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/demokit/docs/kubernetes-devops/devops"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Azure DevOps »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#github-actions-demo-scenarios" class="table-of-contents__link">Github Actions Demo Scenarios</a></li><li><a href="#demo-steps" class="table-of-contents__link">Demo Steps</a><ul><li><a href="#github-actions-pipeline" class="table-of-contents__link">Github Actions Pipeline</a></li><li><a href="#canary-deployment-on-aks" class="table-of-contents__link">Canary Deployment on AKS</a></li><li><a href="#roll-back-on-error" class="table-of-contents__link">Roll back on error</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://teams.microsoft.com/l/channel/19%3a97f9e0c1df4749768074c8d1c3e3bf69%40thread.tacv2/General?groupId=59b14dcc-815c-413a-89b0-49a4228b1705&amp;tenantId=72f988bf-86f1-41af-91ab-2d7cd011db47" target="_blank" rel="noopener noreferrer" class="footer__link-item">Teams</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/azure/demokit/" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 Demo Kit Team. Built with Docusaurus.</div></div></div></footer></div>
<script src="/demokit/styles.0662f249.js"></script>
<script src="/demokit/runtime~main.70ec3584.js"></script>
<script src="/demokit/main.6e8f544f.js"></script>
<script src="/demokit/common.fda475de.js"></script>
<script src="/demokit/2.c70536f9.js"></script>
<script src="/demokit/18.a46e127c.js"></script>
<script src="/demokit/19.4c1ea291.js"></script>
<script src="/demokit/8f5690b9.b140be44.js"></script>
<script src="/demokit/17896441.2b4e130e.js"></script>
<script src="/demokit/2a5ffa6d.2239ce31.js"></script>
</body>
</html>